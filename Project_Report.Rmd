---
title: "Project Report"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
library(patchwork)
library(knitr)
library(readr)
library(ggplot2)
library(broom)

opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
               fig.align = "center", out.width = "100%", dpi = 150)
```

## Motivation

New York sells itself on vibrant public life—but a city’s real magnetism shows up in how well it shares its spaces and resources. Understanding what drives public participation in community events is essential for effective urban planning and equitable resource allocation. NYC Parks hosts thousands of special events each year, yet attendance varies widely across neighborhoods, seasons, and program types. These patterns matter because well-attended events strengthen community engagement, promote physical activity, and ensure that public resources are used efficiently. At the same time, imbalances in participation may reflect disparities in accessibility or programming that does not fully meet community needs. By identifying the conditions associated with higher participation, we aim to provide insights that can help guide more inclusive and effective public programming in New York City.

## Related Work

Research on urban park systems has shown that park accessibility, quality, and programming play an important role in shaping community engagement and wellbeing. For example, [*Public Parks and Wellbeing in Urban Areas of the United States*](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0012939) found that cities with more extensive and accessible park resources tend to report higher levels of physical, social, and emotional wellbeing among residents. This work highlights the broader importance of understanding how public spaces are used and motivates our focus on identifying the factors that drive attendance at NYC Parks special events.

## Initial Questions

At the start of our project, we were interested in understanding what factors influence participation in public events hosted by NYC Parks. Our initial guiding question was: **Which characteristics of an event—such as season, borough, time of day, and intended audience—predict higher attendance?** As we explored the dataset more deeply, this question evolved. We discovered that the audience variable was inconsistently recorded, prompting us to rethink how to capture who an event is designed for. This led us to formulate new questions, such as whether events that are more “kids-friendly,” “senior-friendly,” or “adults-only” tend to attract larger or smaller crowds. During exploratory analysis, additional questions emerged: Do certain boroughs consistently host higher-attended events? Are seasonal patterns stronger for some types of events than others? Does the timing of the event interact with audience type to influence turnout? These evolving questions guided both our descriptive analyses and our final modeling strategy.

## Data

- **Primary dataset:** We used the [*Parks Special Events*](https://data.cityofnewyork.us/Recreation/Parks-Special-Events/6v4b-5gp4/about_data) dataset from NYC Open Data, which documents thousands of public events hosted across New York City parks. The dataset includes information on event type, date and time, location, audience, and estimated attendance. Because the dataset changes over time as new events are added, we downloaded a static [CSV](Parks_Special_Events_20251204.csv) to ensure full reproducibility of our analysis.

To prepare the data for analysis, we performed several cleaning and transformation steps in R:

- **Standardizing structure:** We applied `janitor::clean_names()` to create consistent variable names and converted the event datetime into structured components, including: `date`, `year`, `month`, `day`, and `time`. 

- **Key predictors:** A four-level `season` variable was created based on the event month (Spring: Mar–May, Summer: Jun–Aug, Fall: Sep–Nov, Winter: Dec–Feb). A categorical `time_period` variable (Morning, Afternoon, Night, Midnight) was derived from the event start hour. To characterize where each event occurred, we kept the event’s `borough` and `location_type`. Program-level descriptors included `event_type` and `category`, both of which summarize the content and purpose of the activity.

- **Processing the inconsistent audience field:** The raw `audience` column included messy and inconsistent lists (e.g., “Children; Adults; Seniors; General Public”). We split these entries into cleaned lists and constructed three meaningful accessibility indicators:

  - `kids_friendly`: event includes Children/Kids/Tot or is labeled General Public

  - `senior_friendly`: event includes Seniors or General Public

  - `adults_only`: event does not qualify as kids_friendly

  These binary variables allow us to capture important differences in event targeting despite inconsistencies in the raw text.

- **Cleaning and filtering attendance:** `Attendance` values were converted to numeric and events with missing or empty attendance, event type, or category were removed. We also restricted the dataset to events occurring on or after June 1, 2021, reflecting a period when park programming had largely resumed after COVID-related disruptions.

- **Removing unnecessary variables:** To streamline our analytic dataset, we dropped administrative or unused columns such as unit, group_name_partner, source, and intermediate audience-processing fields.

```{r}
raw = read.csv("Parks_Special_Events_20251204.csv")

parkevent = read.csv("Parks_Special_Events_20251204.csv") |>
  janitor::clean_names() |>
  mutate(
    datetime = mdy_hms(date_and_time),
    date     = as_date(datetime), 
    year  = year(datetime),
    month = month(datetime, label = TRUE, abbr = TRUE),
    day = day(datetime),
    time = format(datetime, "%H:%M:%S"),
    season = case_when(
      month %in% c("Mar","Apr","May") ~ "Spring",
      month %in% c("Jun","Jul","Aug") ~ "Summer",
      month %in% c("Sep","Oct","Nov") ~ "Fall",
      month %in% c("Dec","Jan","Feb") ~ "Winter"), 
      season = factor(season,
        levels = c("Spring", "Summer", "Fall", "Winter")),
    hour = as.numeric(format(datetime, "%H")),
    time_period = case_when(
      hour < 5 ~ "Midnight",
      hour >= 5  & hour < 12 ~ "Morning",
      hour >= 12 & hour < 18 ~ "Afternoon",
      hour >= 18 & hour < 23 ~ "Night",
      hour >= 23   ~ "Midnight"),
   time_period = factor(time_period,
                     levels = c("Morning", "Afternoon", "Night", "Midnight")),
    attendance = as.numeric(attendance))|>  
  
  mutate(
    aud_list = str_split(audience, ";|,"),
    aud_list = map(aud_list, ~ str_trim(.x)),
    has_children = map_lgl(aud_list, ~ any(.x %in% c("Children", "Kids", "Tot"))),
    has_seniors  = map_lgl(aud_list, ~ any(.x %in% c("Seniors", "Senior"))),
    has_genpub   = map_lgl(aud_list, ~ any(.x == "General Public")),
    
    kids_friendly   = has_children | has_genpub,
    senior_friendly = has_seniors  | has_genpub,
    adults_only     = !kids_friendly)|> 
  
  dplyr::select(
    -datetime,
    -unit,
    -group_name_partner,
    -date_and_time,
    -classification,
    -source,
    -hour,
    -event_name,
    -location,
    -audience,
    -aud_list,
    -has_children,
    -has_seniors,
    - has_genpub) |> 
  dplyr::select(
    date, year, month, day, time, season,time_period, everything()) |> 
    filter(date >= as.Date("2021-06-01"),
           event_type != "",
           category != "",
           attendance != "")
```

After cleaning, we have `r nrow(parkevent)` observations and `r ncol(parkevent)` variables. These steps produced a tidy dataset aligned with our study.

#### Summary

| Step | Description | Key Outcome |
|:------|:-------------|:-------------|
| Variable Standardization | Cleaned column names and parsed date-time fields | Structured `date`, `year`, `month`, `day`, `time` |
| Derived Temporal Features | Created `season` and `time_period` | Enabled analysis by time and season |
| Audience Standardization | Generated demographic flags | Classified events by inclusivity |
| Filtering & Reduction | Dropped irrelevant or missing data | `r nrow(parkevent)` valid records retained |
| Final Dataset | Tidy data for analysis | `r ncol(parkevent)` variables across all boroughs |

---

## Descriptive Analysis

### Attendance Summary
```{r fig.width=6, fig.height=4, out.width="60%", fig.align="center"}
parkevent |>
  summarize(
    Mean = mean(attendance),
    Median = median(attendance),
    SD = sd(attendance),
    Min = min(attendance),
    Max= max(attendance)) |>
  knitr::kable(caption = "Table1: Total Attendance Summary", digits = 2)

ggplot(parkevent, aes(x = attendance)) +
  geom_histogram(bins = 40, fill = "steelblue", color = "white") +
  labs(title = "Attendance Distribution (Count)",
       x = "Attendance", y = "Count") +
  theme_minimal()
```

Across all post-COVID events, the average attendance was approximately **`r round(mean(parkevent$attendance), 1)`** participants, with a median of **`r median(parkevent$attendance)`**.  
Attendance ranged from **`r min(parkevent$attendance)`** to **`r max(parkevent$attendance)`**, reflecting a right-skewed distribution dominated by small community events and a limited number of very large gatherings. This spread highlights the diversity of NYC Parks programming—from intimate neighborhood activities to large-scale public festivals.

```{r message = FALSE, warning = FALSE}
table_vars <- c("season", "time_period", "borough", "event_type","location_type")

describe_by_group <- function(var) {
  parkevent |>
    group_by(across(all_of(var))) |>
    summarize(
      Count= n(),
      Mean= mean(attendance, na.rm = TRUE),
      Median= median(attendance, na.rm = TRUE),
      SD= sd(attendance, na.rm = TRUE),
      Min = min(attendance, na.rm = TRUE),
      Max = max(attendance, na.rm = TRUE),
      Sum = sum(attendance, na.rm = TRUE),
      .groups = "drop"
    ) |>
    rename(Level = !!var) |>
    mutate(Variable = var)
}
summary_all <- purrr::map_df(table_vars, describe_by_group)
summary_all <- summary_all |>
  group_by(Variable) |>
  mutate(variable_disp = if_else(row_number() == 1,
                                 Variable,
                                 "")) |>
  ungroup()
knitr::kable(
  summary_all |>
    dplyr::select(Variable = variable_disp, Level, Count, Mean, Median, SD, Min, Max,Sum),
  digits  = 2,
  caption = "Table 2: Attendance Summary by Subgroup")
```

Table 2 shows attendance varied substantially across time, seasons, and event characteristics. Most events took place in Summer and Fall, reflecting NYC’s outdoor activity trends. Afternoon events had the largest counts, followed by Night. Attendance also differed across boroughs and event types, with parks and community events supporting the greatest participation. These subgroup summaries provide essential baseline context for downstream modeling. 

---

### Attendance Patterns Across Categories

```{r message = FALSE, warning = FALSE}
plot_season =
  ggplot(parkevent, aes(x = season, y = attendance, fill=season)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width=0.15) +
  coord_cartesian(ylim = c(0,250)) +
  scale_x_discrete(labels = c(
    "Spring" = "Spr",
    "Summer" = "Sum",
    "Fall"   = "Fal",
    "Winter" = "Win")) +
  labs(title = "By Season", x = "Season", y = "Attendance") +
  guides(fill = "none") +
  theme_minimal()

plot_time =
  ggplot(parkevent, aes(x = time_period, y = attendance, fill=time_period)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width=0.15) +
  coord_cartesian(ylim = c(0,250)) +
  scale_x_discrete(labels = c(
    "Morning"   = "Morn",
    "Afternoon" = "Aft",
    "Night"     = "Ngt",
    "Midnight"  = "Mid")) +
  labs(title = "By Time of Day", x = "Time of Day", y = "Attendance") +
  guides(fill = "none") +
  theme_minimal()

plot_type =
  ggplot(parkevent, aes(x = event_type, y = attendance, fill = event_type)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width = 0.15) +
  coord_cartesian(ylim = c(0,250)) +
  scale_x_discrete(labels = c(
    "Agency Produced Event" = "Agency",
    "Community Based Event" = "Community",
    "Local Event" = "Local",
    "Open House" = "Open",
    "Tournament/Competition" = "Competition")) +
   guides(fill = "none") +
  labs(
    title = "By Event Type",
    x = "Event Type",
    y = "Attendance") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot_borough =
  ggplot(parkevent, aes(x = borough, y = attendance, fill=borough)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width=0.15) +
  coord_cartesian(ylim = c(0,250)) +
  scale_x_discrete(labels = c(
    "Bronx"        = "BX",
    "Brooklyn"     = "BKN",
    "Manhattan"    = "MAN",
    "Queens"       = "QNS",
    "Staten Island"= "SI")) +
  labs(title = "By Borough", x = "Borough", y = "Attendance") +
  guides(fill = "none") +
  theme_minimal()

plot_location =
  ggplot(parkevent, aes(x = location_type, y = attendance, fill = location_type)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width = 0.15) +
  coord_cartesian(ylim = c(0,250)) +
  scale_x_discrete(labels = c(
    "Nature Center" = "Nature",
    "Recreation Center" = "RecCen",
    "Playground" = "Playground",
    "Pool" = "Pool",
    "Park" = "Park",
    "Other" = "Other",
    "School" = "School")) +
  labs(
    title = "By Location Type",
    x = "Location Type",
    y = "Attendance") +
   guides(fill = "none") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

parkevent_long <- parkevent |> 
  pivot_longer(
    cols = c(kids_friendly, senior_friendly, adults_only),
    names_to  = "audience_type",
    values_to = "flag"
  ) |> 
  filter(flag) |> 
  dplyr::select(-flag) |> 
  mutate(
    audience_type = recode(
      audience_type,
      kids_friendly   = "Kids",
      senior_friendly = "Seniors",
      adults_only     = "Adults"))

plot_audience =
  ggplot(parkevent_long,
         aes(x = audience_type, y = attendance, fill = audience_type)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width = 0.15) +
  coord_cartesian(ylim = c(0, 250)) +
  labs(
    title = "By Audience Type",
    x = "Audience Type",
    y = "Attendance") +
  guides(fill = "none") +
  theme_minimal()

patterns_plot =
  ((plot_season |plot_time| plot_borough) /
    (plot_audience|plot_type| plot_location))+
  plot_annotation(
    title = "Figure 1: Attendance Patterns Across NYC Parks Events",
    theme = theme())
patterns_plot
```

*The violin shapes represent the full distribution of attendance within each category, while the internal boxplots mark median and interquartile ranges. For interpretability, the y-axis is truncated at **250 attendees**, encompassing the majority of events and minimizing distortion from a few extremely large gatherings.*

The figure above presents violin–boxplots showing attendance distributions across major event characteristics:

- **Season:** Attendance is right-skewed in all seasons. Spring and fall events show slightly higher median attendance and more variability compared to summer and winter. This pattern likely reflects more comfortable weather conditions, which make outdoor programming more appealing and accessible.
- **Time of Day:** Night and midnight events have larger audiences as well as larger variations.   
- **Borough:** Brooklyn and Manhattan exhibit larger spreads and more high-attendance events. Staten Island and the Bronx tend to have lower medians, suggesting geographic differences in program scale or population density.
- **Audience Type:** Adults-only events have the lowest median attendance and a relatively compact distribution. Kids-friendly and senior-friendly events show wider spreads, with both groups including numerous higher-attendance outliers. This suggests that events designed for families or seniors may draw more participants than strictly adult-oriented programming.
- **Event Type:** Community-based, open house, and competetion events show higher medians and wider distributions, whereas agency-sponsored or local events tend to draw smaller and more consistent crowds.
- **Location Type:** School-based events show the highest median attendance and the widest spread, indicating frequent large gatherings. Parks and playgrounds also show a broad distribution with many mid- to high-attendance events. In contrast, nature centers and pools tend to host smaller events, with lower medians and tighter distributions.

---

### Audience Targeting by Borough

To understand how NYC Parks programs are designed for different groups, we analyzed event audience targeting across boroughs and months. Using the cleaned audience-type indicators (Adults-only, Kids-friendly, and Senior-friendly), the stacked bar charts below show the proportion of events targeting each group across boroughs and months.

```{r message = FALSE, warning = FALSE}
c =
ggplot(parkevent_long,
       aes(x = borough, fill = audience_type)) +
  geom_bar(position = "fill") +
  labs(
    x = "Borough",
    y = "Proportion",
    fill = "Audience Type"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

d =
ggplot(parkevent_long,
       aes(x = month, fill = audience_type)) +
  geom_bar(position = "fill") +
  labs(
    x = "Month",
    y = "Proportion",
    fill = "Audience Type"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

c + d +
  plot_layout(widths = c(1, 2), guides = "collect") +
  plot_annotation(
    title = "Figure 2: Audience Composition by Borough and Month") &
    theme(
    legend.position = "bottom"
  )
```

The left chart illustrates how event targeting varies across the five boroughs:

- Kids-friendly events make up the majority of programming in every borough. This reflects NYC Parks’ emphasis on family-oriented and child-inclusive events.
- Senior-friendly events also represent a large share, generally 40–45% of all events, indicating strong support for older adult engagement citywide.
- Adults-only events are the smallest category, usually under 15%. This suggests that most park events are intended to be inclusive rather than restricted to adults.
  
  Although boroughs differ slightly (e.g., Manhattan host the least adults-only events overall), event targeting is highly consistent across boroughs, reflecting similar programming priorities citywide.

The right chart shows how event targeting shifts throughout the calendar year:

- Kids-friendly events dominate in all months, but the proportion is lower in winter and early spring (Jan–Mar) and higher in summer and early fall (Jun–Sep).
- Senior-friendly events show a seasonal rise, increasing steadily from spring into late summer. Warmer months may support more senior-accessible outdoor programming.
- Adults-only events fluctuate modestly, with slightly higher proportions in winter, possibly reflecting specific seasonal event types.

  These patterns suggest that NYC Parks adjusts event design seasonally, offering more inclusive and multigenerational programming during peak outdoor months.

---

### Seasonal Attendance Analysis

To investigate how event participation fluctuates with seasonal and temporal factors, we analyzed mean attendance patterns by both **time of day** and **borough**, stratified across the four seasons. These comparisons highlight the interplay between seasonal climate conditions, event scheduling, and geographic context in shaping NYC Parks’ public engagement.

```{r message = FALSE, warning = FALSE}
plot_time_season =
  parkevent |>
  group_by(time_period, season) |>
  summarize(mean_attendance = mean(attendance)) |>
  ggplot(aes(x = time_period, 
             y = mean_attendance, 
             color = season, 
             group = season)) +
  geom_line() +
  geom_point() +
  labs(
    title = "3A: Mean Attendance by Time of Day Across Seasons",
    x = "Time of Day",
    y = "Mean Attendance",
    color = "Season") +
  theme_minimal()

plot_borough_season =
  parkevent |>
  group_by(borough, season) |>
  summarize(mean_attendance = mean(attendance)) |>
  ggplot(aes(x = season, 
             y = mean_attendance, 
             color = borough, 
             group = borough)) +
  geom_line() +
  geom_point() +
   scale_color_brewer(palette = "Dark2") +  
  labs(
    title = "3B:Mean Attendance by Seasons Across Borough",
    x = "Season",
    y = "Mean Attendance",
    color = "borough") +
  theme_minimal()

Seasonal_plot =
  (plot_time_season / plot_borough_season) +
  plot_annotation(
    title = "Figure 3: Seasonal Attendance Patterns Across NYC Park Events")

Seasonal_plot
```

Figure 3A: Mean Attendance by Time of Day Across Seasons

- Spring and fall has the highest attendance in the morning and afternoon.
- Summer attendance gradually increases throughout the day, with the highest turnout at midnight.
- Winter attendance is lowest, with a steep drop at midnight.

Figure 3B: Mean Attendance by Season Across Boroughs

- Spring is the strongest season for most boroughs, especially Brooklyn and Staten Island.
- Summer attendance dips across all boroughs except for Manhattan.
- Fall rebounds except for Brooklyn, with Queens showing high participation.
- Winter attendance declines everywhere, with the Bronx showing the lowest turnout.

Across NYC Parks events, attendance varies meaningfully by both season and location. Spring and fall afternoons draw the highest engagement, while winter events attract substantially smaller crowds. Borough-level differences are also pronounced: Queens consistently attracts larger audiences in both fall and winter, whereas the Bronx shows the lowest attendance across all seasons.

---

### Attendance Over the Calendar Year

```{r message = FALSE, warning = FALSE}
plot_calendar =
  ggplot(parkevent, 
         aes(x = month(date, label = TRUE, abbr = TRUE), 
             y = attendance)) +
  geom_point(alpha = 0.2, color = "gray70") +
  stat_summary(fun = mean, geom = "line", aes(group = 1),
               color = "cornflowerblue", size = 1) +
  stat_summary(fun = mean, geom = "point",
               color = "cornflowerblue", size = 2) +
  labs(
    title = "Figure 4: Attendance Over the Calendar Year",
    x = "Month",
    y = "Attendance") +
  coord_cartesian(ylim = c(0, 250)) + 
  theme_minimal()
plot_calendar
```

Figure 4 illustrates how attendance at NYC Parks events changes across the calendar year. Each grey point represents attendance at an individual event, while the blue line shows the monthly mean, highlighting broader seasonal patterns that daily fluctuations may obscure. This combined view provides both the overall seasonal trend and the variability within each month.

Attendance is lowest in February and increases sharply through March and April, reflecting improving weather and expanded outdoor programming. Attendance levels remain moderate and relatively steady from May to June, with a decline in July likely due to extreme heat or travel patterns. Participation increases again in September–October, with October showing the highest average attendance levels of the year. December shows another uptick, consistent with holiday-themed programming and community events.

It is important to note a wide within-month variability. The vertical spread of grey points indicates that months include a mix of small-scale events and occasional large gatherings.

---

## Modeling

### Modeling Workflow Diagram

                         ┌──────────────────────────────────┐
                         │  Exploratory Data Analysis (EDA) │
                         │  - Histogram of attendance       │
                         │  - mean–variance check           │
                         │  → Identify skewness & overdispersion
                         └──────────────────────────────────┘
                                         │
                                         ▼
                   ┌───────────────────────────────────────────────┐
                   │ Univariate Analysis                           │
                   │ - Kruskal–Wallis tests for each predictor     │
                   │ - Compute η² effect sizes                     │
                   │ → Assess which predictors show meaningful     │
                   │   variation in attendance                     │
                   └───────────────────────────────────────────────┘
                                         │
                                         ▼
             ┌──────────────────────────────────────────────────────────┐
             │ Model Building: Cross-Validated Variable Selection       │
             │ - Define Simple, Medium, Full predictor sets             │
             │ - Monte Carlo CV with RMSE as performance metric         │
             │ → Select predictor set with best out-of-sample RMSE      │
             └──────────────────────────────────────────────────────────┘
                                         │
                                         ▼
             ┌──────────────────────────────────────────────────────────┐
             │ Final Model Fitting                                      │
             │ - Fit Negative Binomial regression using selected vars   │
             │ - Extract IRRs and confidence intervals                  │
             │ → Interpret effect sizes and direction of associations   │
             └──────────────────────────────────────────────────────────┘
                                         │
                                         ▼
                   ┌───────────────────────────────────────────────┐
                   │ Final Inference & Interpretation              │
                   │ - Discuss strongest predictors                │
                   │ - Compare event characteristics & attendance  │
                   │ - Guide practical recommendations             │
                   └───────────────────────────────────────────────┘
---

### Exploratory distribution plots
Before conducting formal statistical analyses, we examined the distribution of the outcome variable, attendance, to assess its shape and variability. Understanding the distribution is essential for determining whether parametric assumptions are met and for selecting an appropriate modeling framework.    
```{r message = FALSE, warning = FALSE}
 a <- ggplot(parkevent, aes(x = attendance)) +
  geom_histogram(bins = 40, fill = "steelblue", color = "white") +
  labs(title = "Attendance Distribution (Count)",
       x = "Attendance", y = "Count") +
  theme_minimal()

b <- ggplot(parkevent, aes(x = attendance)) +
  geom_histogram(bins = 40, fill = "tomato", color = "white") +
  scale_x_log10() +
  labs(title = "Attendance Distribution (Log Scale)",
       x = "Attendance (log10 scale)", y = "Count") +
  theme_minimal()

a+b
```

```{r}
mean_var <- parkevent |>
  summarise(mean_att = mean(attendance), var_att = var(attendance)) |>
  rename(
    `Mean Attendance`   = mean_att,
    `Variance of Attendance` = var_att)

knitr::kable(mean_var, digits = 2, caption = "Mean and Variance of Event Attendance")
```

Exploratory plots revealed that attendance is highly right-skewed with a long tail, and the variance greatly exceeds the mean, indicating overdispersion. These characteristics justify the use of non-parametric tests in the univariate stage and a Negative Binomial model for the final multivariable analysis.

---

### Univariate Analysis
We first examined whether attendance differed across levels of each categorical predictor (season, time of day, borough, event type, location type, and audience-related indicators) using the Kruskal–Wallis test, a non-parametric method appropriate for skewed count outcomes. For each variable, we also computed an η² effect size to quantify the magnitude of group differences. These results provide an initial assessment of which predictors meaningfully explain variation in attendance and should be considered in subsequent multivariable modeling.

```{r}
library(MASS)
library(modelr)
```

```{r}
predictors <- c("season", "time_period", "borough",
                "event_type", "location_type",
                "kids_friendly", "senior_friendly", "adults_only")

#Function to compute eta-squared for KW
eta_kw <- function(x, g){
  kw <- kruskal.test(x ~ g)
  H  <- kw$statistic
  k  <- length(unique(g))
  n  <- length(x)
  eta2 <- as.numeric((H - k + 1) / (n - k))
  return(eta2)
}

# Run Kruskal–Wallis tests for all predictors
kw_results <- map_df(predictors, ~ {
  form <- as.formula(paste("attendance ~", .x))
  
  kt  <- broom::tidy(kruskal.test(form, data = parkevent))
  eta2 <- eta_kw(parkevent$attendance, parkevent[[.x]])
  
  kt |> 
    mutate(variable = .x,
           eta2 = eta2)
})

# Classify effect sizes ----
kw_results <- kw_results |> 
  mutate(effect_strength = case_when(
    eta2 >= 0.14 ~ "large",
    eta2 >= 0.06 ~ "medium",
    eta2 >= 0.01 ~ "small",
    TRUE ~ "very small"
  ))

kw_results |>
  dplyr::select (variable, p.value, effect_strength) |>
  dplyr::mutate(
    p.value = format(p.value, scientific = TRUE, digits = 3)) |>
  knitr::kable(caption = "Kruskal–Wallis Test Results: P-values and Effect Size Classification")
```
Across all predictors, the Kruskal–Wallis tests indicated statistically significant differences in attendance (p < 0.05), with effect sizes ranging from very small to medium. Variables with medium η² values (event type and location type) show stronger associations with attendance and were prioritized for inclusion in the multivariable model.

To evaluate their combined predictive value and adjust for potential confounding, we proceeded to build multivariable models.

---

### Multivariable Model: Negative Binomial Regression

To identify the predictors that best explain variation in attendance, we compared several candidate models using cross-validated RMSE, an unbiased measure of out-of-sample predictive performance. We used log-linear models for this stage because they are computationally stable and well-suited for repeated Monte Carlo cross-validation. Based on the RMSE comparison, we selected the most predictive set of variables and then refit the final model using Negative Binomial regression, which is appropriate for inference with overdispersed count outcomes such as attendance.   

```{r message = FALSE, warning = FALSE}
#Define candidate models
form_simple <- log(attendance + 1) ~ event_type + location_type

form_medium <- log(attendance + 1) ~ season + time_period + borough +
  event_type + location_type

form_full <- log(attendance + 1) ~ season + time_period + borough +
  event_type + location_type + kids_friendly + senior_friendly + adults_only

#cross-validated RMSE
cv_rmse <- function(formula, data, n_splits = 50, test_prop = 0.1) {
  set.seed(123)
  
cv <- crossv_mc(data, n_splits, test = test_prop)
  
cv <- cv %>%
    mutate(
      model = map(train, ~ lm(formula, data = .x)),
      rmse  = map2_dbl(model, test, ~ rmse(.x, .y))
    )
  
mean(cv$rmse)
}

rmse_simple <- cv_rmse(form_simple, parkevent, n_splits = 50, test_prop = 0.1)
rmse_medium <- cv_rmse(form_medium, parkevent, n_splits = 50, test_prop = 0.1)
rmse_full   <- cv_rmse(form_full,   parkevent, n_splits = 50, test_prop = 0.1)

cv_results <- tibble(
  model     = c("Simple", "Medium", "Full"),
  mean_RMSE = c(rmse_simple, rmse_medium, rmse_full)
)

cv_results |> knitr::kable(digits = 2)
```

Cross-validated RMSE values were similar across the three candidate models, with the Full model achieving the lowest prediction error (RMSE = 1.4263). Although the difference is modest, the Full model provided the best out-of-sample predictive performance and was therefore selected for the final analysis.    

Using the selected predictor set, we fit our final model with a Negative Binomial regression: 

```{r message = FALSE, warning = FALSE}
model_nb <- glm.nb(
  attendance ~ season + time_period + borough +
    event_type + location_type + kids_friendly + senior_friendly + adults_only,
  data = parkevent
)

irr_table <- tidy(model_nb, conf.int = TRUE, exponentiate = TRUE)
irr_table |>  
  mutate(across(where(is.numeric), ~ round(.x, 3))) %>%
  knitr::kable(caption = "Negative Binomial Model Results")

```

```{r echo=FALSE, message=FALSE}
fmt <- function(x) format(round(x, 2), nsmall = 2)

get_ci <- function(df, term_name) {
  vals <- df |> dplyr::filter(term == term_name)
  list(
    irr  = fmt(vals$estimate),
    low  = fmt(vals$conf.low),
    high = fmt(vals$conf.high)
  )
}

terms <- irr_table$term

IRR_vals <- lapply(terms, function(t) get_ci(irr_table, t))
names(IRR_vals) <- terms
```

In this model, attendance is modeled as a function of season, time of day, borough, event type, location type, and audience indicators. We exponentiate the coefficients to obtain incidence rate ratios (IRRs) and 95% confidence intervals, which quantify the multiplicative change in expected attendance associated with each predictor while holding the others constant.

The Negative Binomial model shows that several event characteristics are strongly associated with attendance. 
Compared with spring events, winter events have significantly lower expected attendance (IRR = `r IRR_vals$seasonWinter$irr`, 95% CI: `r IRR_vals$seasonWinter$low`–`r IRR_vals$seasonWinter$high`), while summer and fall do not differ significantly from spring. 

Afternoon and night events attract more participants than morning events (Afternoon: IRR = `r IRR_vals$time_periodAfternoon$irr`, 95% CI: `r IRR_vals$time_periodAfternoon$low`–`r IRR_vals$time_periodAfternoon$high`; Night: IRR = `r IRR_vals$time_periodNight$irr`, 95% CI: `r IRR_vals$time_periodNight$low`–`r IRR_vals$time_periodNight$high`). Relative to Bronx, events in Manhattan, Queens, and Staten Island show higher attendance (IRRs ≈ `r IRR_vals$boroughQueens$irr`-`r IRR_vals$boroughManhattan$irr`), with Manhattan having the largest effect. 

Community-based events have higher attendance than Agency Produced events (IRR = `r IRR_vals[["event_typeCommunity Based Event"]]$irr`, 95% CI: `r IRR_vals[["event_typeCommunity Based Event"]]$low`–`r IRR_vals[["event_typeCommunity Based Event"]]$high`), and events held in schools and parks are particularly well-attended (School: IRR = `r IRR_vals$location_typeSchool$irr`, 95% CI: `r IRR_vals$location_typeSchool$low`–`r IRR_vals$location_typeSchool$high`; Park: IRR = `r IRR_vals$location_typePark$irr`, 95% CI: `r IRR_vals$location_typePark$low`–`r IRR_vals$location_typePark$high`). 

For the audience, the kids-friendly and senior-friendly indicators are not individually significant after adjustment for other covariates.

```{r}
irr_table2 <- irr_table %>%
  filter(term != "(Intercept)") %>%
  mutate(
    significant = ifelse(conf.low > 1 | conf.high < 1, "Significant", "Not Significant")
  )

ggplot(irr_table2, aes(x = reorder(term, estimate), y = estimate,
                       color = significant)) +
  geom_point(size = 3) +
   geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
  geom_hline(yintercept = 1, linetype = "dashed") +
  scale_color_manual(values = c("Significant" = "red", 
                                "Not Significant" = "steelblue")) +
  coord_flip() +
  labs(
    title = "Incidence Rate Ratios (IRRs) with 95% Confidence Intervals",
    x = "Predictor",
    y = "IRR",
    color = ""
  ) +
  theme_minimal(base_size = 13)
```


## Discussion

This project provides insight into how seasonal, temporal, geographic, and programmatic factors shape public participation in NYC Parks events. Descriptively, attendance was highly variable and right-skewed, with spring and fall events—especially in the morning and afternoon—drawing the highest engagement. Borough-level differences were substantial: Queens attracted larger audiences in fall and winter, while the Bronx had the lowest turnout, suggesting uneven distribution of community engagement across the city.

Multivariable Negative Binomial modeling clarified which characteristics independently predict attendance. After adjustment, winter events had significantly lower expected attendance, and afternoon and night events drew more participants than morning events. Borough differences persisted, with Manhattan, Queens, and Staten Island showing higher expected attendance relative to the Bronx. Community-based and competition-style events attracted significantly more participants, and events held in schools or parks had the strongest positive associations. Adults-only events consistently drew fewer participants, reinforcing the importance of family-inclusive programming.

Overall, these findings highlight actionable opportunities for NYC Parks. Strengthening winter programming, expanding family-oriented events, and leveraging high-performing locations such as schools and parks may help increase turnout. Borough disparities also suggest a need for targeted outreach and resource allocation to support lower-attendance areas.

### Limitations

This analysis is based on the dataset available as of December 4, 2025, which continues to update over time; therefore, results reflect only a snapshot rather than the full evolving dataset. Additionally, the models do not incorporate external factors such as weather, neighborhood socioeconomic characteristics, or event marketing reach, which may also influence attendance and could be explored in future work.















